<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Storage Debug Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-top: 0;
        }

        h2 {
            color: #555;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #45a049;
        }

        button.danger {
            background: #f44336;
        }

        button.danger:hover {
            background: #da190b;
        }

        pre {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 300px;
        }

        .success {
            color: #4CAF50;
            font-weight: bold;
        }

        .error {
            color: #f44336;
            font-weight: bold;
        }

        .info {
            color: #2196F3;
        }

        #output {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” Room System Debug Tool</h1>

        <h2>1. GÃ¶rÃ¼ntÃ¼le LocalStorage</h2>
        <button onclick="showAllStorage()">TÃ¼m LocalStorage'Ä± GÃ¶ster</button>
        <button onclick="showRoomData()">Sadece Oda Verilerini GÃ¶ster</button>

        <h2>2. Temizle</h2>
        <button class="danger" onclick="clearRoomData()">Oda Verilerini Temizle (Room 1, Room 2 dahil)</button>
        <button class="danger" onclick="clearAllStorage()">TÃœM LocalStorage'Ä± Temizle</button>

        <h2>3. Test SenaryolarÄ±</h2>
        <button onclick="testCurrentUser()">Mevcut KullanÄ±cÄ±yÄ± Test Et</button>
        <button onclick="testUserRooms()">KullanÄ±cÄ±nÄ±n OdalarÄ±nÄ± Test Et</button>

        <div id="output"></div>
    </div>

    <script>
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            output.appendChild(div);
        }

        function clear() {
            output.innerHTML = '';
        }

        function showAllStorage() {
            clear();
            log('<h3>ğŸ“¦ TÃ¼m LocalStorage Ä°Ã§eriÄŸi:</h3>');
            const items = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                items[key] = localStorage.getItem(key);
            }
            log('<pre>' + JSON.stringify(items, null, 2) + '</pre>');
        }

        function showRoomData() {
            clear();
            log('<h3>ğŸ  Oda Ä°lgili Veriler:</h3>');

            // Rooms list
            const rooms = JSON.parse(localStorage.getItem('aitutor_rooms') || '[]');
            log(`<strong>aitutor_rooms:</strong> ${JSON.stringify(rooms)}`);

            // Current user
            const currentUser = JSON.parse(localStorage.getItem('aitutor_current_user') || '{}');
            log(`<br><strong>Current User:</strong> ${currentUser.email || 'Yok'} (${currentUser.role || 'Yok'})`);

            // Room details
            log('<br><strong>Oda DetaylarÄ±:</strong>');
            rooms.forEach(room => {
                const roomKey = `room_${room.replace(/\s+/g, '_')}`;
                const members = JSON.parse(localStorage.getItem(roomKey + '_members') || '[]');
                const creator = localStorage.getItem(roomKey + '_creator') || 'Yok';

                log(`<br>ğŸ·ï¸ <strong>${room}</strong>`);
                log(`&nbsp;&nbsp;Creator: ${creator}`);
                log(`&nbsp;&nbsp;Members: ${members.join(', ') || 'Yok'}`);

                // Check if current user is member
                if (currentUser.email) {
                    const isMember = members.some(m => m.toLowerCase() === currentUser.email.toLowerCase());
                    log(`&nbsp;&nbsp;${currentUser.email} Ã¼ye mi? ${isMember ? 'âœ… EVET' : 'âŒ HAYIR'}`, isMember ? 'success' : 'error');
                }
            });
        }

        function clearRoomData() {
            if (!confirm('TÃ¼m oda verileri silinecek. Emin misiniz?')) return;

            clear();

            // Get all room names first
            const rooms = JSON.parse(localStorage.getItem('aitutor_rooms') || '[]');

            // Remove each room's data
            rooms.forEach(room => {
                const roomKey = `room_${room.replace(/\s+/g, '_')}`;
                localStorage.removeItem(roomKey);
                localStorage.removeItem(roomKey + '_members');
                localStorage.removeItem(roomKey + '_creator');
                log(`Silindi: ${room}`, 'success');
            });

            // Clear rooms list
            localStorage.setItem('aitutor_rooms', '[]');
            log('aitutor_rooms boÅŸ listeye sÄ±fÄ±rlandÄ±', 'success');

            // Clear invitations
            localStorage.removeItem('aitutor_invitations');
            log('Davetler temizlendi', 'success');

            log('<br><strong class="success">âœ… TÃ¼m oda verileri temizlendi!</strong>');
            log('<br><em>Åimdi sayfayÄ± yenileyip (F5) test edin.</em>', 'info');
        }

        function clearAllStorage() {
            if (!confirm('TÃœM LocalStorage temizlenecek (oturum dahil). Emin misiniz?')) return;

            clear();
            localStorage.clear();
            log('<strong class="success">âœ… TÃ¼m LocalStorage temizlendi!</strong>');
            log('<br><em>SayfayÄ± yenileyip tekrar giriÅŸ yapmanÄ±z gerekecek.</em>', 'info');
        }

        function testCurrentUser() {
            clear();
            const currentUser = JSON.parse(localStorage.getItem('aitutor_current_user') || '{}');

            if (!currentUser.email) {
                log('âŒ Mevcut kullanÄ±cÄ± bulunamadÄ±!', 'error');
                return;
            }

            log(`âœ… Mevcut KullanÄ±cÄ±: ${currentUser.email}`, 'success');
            log(`Rol: ${currentUser.role}`);
            log(`Ä°sim: ${currentUser.name}`);
        }

        function testUserRooms() {
            clear();

            const currentUser = JSON.parse(localStorage.getItem('aitutor_current_user') || '{}');
            if (!currentUser.email) {
                log('âŒ Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!', 'error');
                return;
            }

            log(`<h3>ğŸ” ${currentUser.email} iÃ§in oda testi:</h3>`);

            const allRooms = JSON.parse(localStorage.getItem('aitutor_rooms') || '[]');
            log(`Toplam oda sayÄ±sÄ±: ${allRooms.length}`);

            const myRooms = allRooms.filter(roomName => {
                const roomKey = `room_${roomName.replace(/\s+/g, '_')}`;
                const members = JSON.parse(localStorage.getItem(roomKey + '_members') || '[]');
                return members.some(m => m.toLowerCase() === currentUser.email.toLowerCase());
            });

            log(`<br><strong>GÃ¶rÃ¼nmesi gereken odalar (${myRooms.length}):</strong>`);
            if (myRooms.length > 0) {
                myRooms.forEach(room => log(`&nbsp;&nbsp;âœ… ${room}`, 'success'));
            } else {
                log('&nbsp;&nbsp;âŒ HiÃ§ oda yok!', 'error');
            }

            log(`<br><strong>GÃ¶rÃ¼nmemesi gereken odalar (${allRooms.length - myRooms.length}):</strong>`);
            const notMyRooms = allRooms.filter(r => !myRooms.includes(r));
            if (notMyRooms.length > 0) {
                notMyRooms.forEach(room => log(`&nbsp;&nbsp;âŒ ${room}`, 'error'));
            } else {
                log('&nbsp;&nbsp;âœ… TÃ¼m odalar size ait!', 'success');
            }
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            showRoomData();
        });
    </script>
</body>

</html>